**************
Code Structure
**************

This is an overview the internal structure of the code, catering to those who
want to add functionality or support reading a new format.

Baseband's source code is located under the :file:`baseband` directory.  The
Python files in this folder link baseband and astropy together, enable the
Astropy test system, or are auto-generated by :file:`setup.py`.  Subfolders in 
:file:`baseband` include

- :file:`baseband/data` - stores data snippets for testing and tutorials
- :file:`baseband/helpers` - helper functions
- :file:`baseband/tests` - baseband tests run by the Astropy testing framework
- :file:`baseband/vlbi_base` - stores common to all readers

All other folders store the classes needed to read a particular file format, 
such as dada, mark5b, or vdif.  These are children of classes in 
:file:`vlbi_base`, and similar inheritance should be used when including a 
reader for a new format.  To understand how :file:`vlbi_base` is connected to
the readers, we consider what happens when a vdif file is read.

.. _cs_vdif_intro:

VDIF Reader
===========

To read in binary mode the sample VDIF file included with baseband, we use the
``vdif`` class 

::

>>> from baseband import vdif
>>> from baseband.data import SAMPLE_VDIF
>>> fh = vdif.open(SAMPLE_VDIF, 'rs')
>>> d = fh.read()

(``SAMPLE_VDIF`` is simply the ``str`` :file:`baseband/data/sample.vdif`.)

:func:`vdif.open() <baseband.vdif.open>` is the only function or class in the ``vdif`` module 
directly accessible from :class:`~baseband.vdif` as, in lieu of troubeshooting, 
it is the only thing users should access.  The functions and classes used by
:func:`vdif.open() <baseband.vdif.open>` are in

- :file:`baseband/vdif/base.py` - defines :func:`vdif.open() <baseband.vdif.open>`, 
  stream reader and writer classes
- :file:`baseband/vdif/frame.py` - contains VDIF data storage container class
- :file:`baseband/vdif/header.py` - contains VDIF header readers
- :file:`baseband/vdif/payload.py` - contains VDIF data readers
- :file:`baseband/vdif/tests/` - defines routines to test :file:`baseband/vdif`

This code structure is repeated for all other supported file formats, and ought
to be followed when creating custom file support.


Specific file formats
=====================

.. toctree::
   :maxdepth: 1

   code_struct/vdif
